-- -------------------------------------------------------------
-- 
-- File Name: /home/cb54103/Documents/fpga-open-speech-tools/simulink_models/models/Dynamic_Compression_Model/hdlsrc/sm_DynamicCompression/sm_DynamicCompression_Addr_Gen.vhd
-- 
-- Generated by MATLAB 9.7 and HDL Coder 3.15
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: sm_DynamicCompression_Addr_Gen
-- Source Path: sm_DynamicCompression/dataplane/Avalon Data Processing/Left Channel Processing/recalculate/Nchan_FbankAGC_AID/Static_pFIR/Addr_Gen 
-- Hierarchy Level: 6
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY sm_DynamicCompression_Addr_Gen IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb_1_1024_0                      :   IN    std_logic;
        enb                               :   IN    std_logic;
        Input_Addr                        :   OUT   std_logic_vector(9 DOWNTO 0);  -- ufix10
        Data_History_Rd_addr              :   OUT   std_logic_vector(9 DOWNTO 0);  -- ufix10
        End_of_sample_calc                :   OUT   std_logic;
        b_k_addr                          :   OUT   std_logic_vector(9 DOWNTO 0)  -- ufix10
        );
END sm_DynamicCompression_Addr_Gen;


ARCHITECTURE rtl OF sm_DynamicCompression_Addr_Gen IS

  -- Signals
  SIGNAL Input_Addr_Counter_out1          : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Rate_Transition_out1             : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Constant_out1                    : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Add_out1                         : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Counter_0_to_b_k_1_out1          : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Subtract_op_stage2               : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Realignment_delay_out1           : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Subtract_out1                    : unsigned(9 DOWNTO 0);  -- ufix10
  SIGNAL Compare_To_Zero_out1             : std_logic;

BEGIN
  -- Realign Delay here?

  -- Free running, Unsigned Counter
  --  initial value   = 0
  --  step value      = 1
  -- 
  Input_Addr_Counter_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      Input_Addr_Counter_out1 <= to_unsigned(16#000#, 10);
    ELSIF rising_edge(clk) THEN
      IF enb_1_1024_0 = '1' THEN
        Input_Addr_Counter_out1 <= Input_Addr_Counter_out1 + to_unsigned(16#001#, 10);
      END IF;
    END IF;
  END PROCESS Input_Addr_Counter_process;


  Rate_Transition_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      Rate_Transition_out1 <= to_unsigned(16#000#, 10);
    ELSIF rising_edge(clk) THEN
      IF enb_1_1024_0 = '1' THEN
        Rate_Transition_out1 <= Input_Addr_Counter_out1;
      END IF;
    END IF;
  END PROCESS Rate_Transition_process;


  Constant_out1 <= to_unsigned(16#001#, 10);

  Add_out1 <= Rate_Transition_out1 + Constant_out1;

  Input_Addr <= std_logic_vector(Add_out1);

  -- Free running, Unsigned Counter
  --  initial value   = 0
  --  step value      = 1
  -- 
  Counter_0_to_b_k_1_process : PROCESS (clk, reset)
  BEGIN
    IF reset = '1' THEN
      Counter_0_to_b_k_1_out1 <= to_unsigned(16#000#, 10);
    ELSIF rising_edge(clk) THEN
      IF enb = '1' THEN
        Counter_0_to_b_k_1_out1 <= Counter_0_to_b_k_1_out1 + to_unsigned(16#001#, 10);
      END IF;
    END IF;
  END PROCESS Counter_0_to_b_k_1_process;


  Subtract_op_stage2 <= Rate_Transition_out1 - Counter_0_to_b_k_1_out1;

  Realignment_delay_out1 <= to_unsigned(16#01A#, 10);

  Subtract_out1 <= Subtract_op_stage2 - Realignment_delay_out1;

  Data_History_Rd_addr <= std_logic_vector(Subtract_out1);

  
  Compare_To_Zero_out1 <= '1' WHEN Counter_0_to_b_k_1_out1 = to_unsigned(16#000#, 10) ELSE
      '0';

  b_k_addr <= std_logic_vector(Counter_0_to_b_k_1_out1);

  End_of_sample_calc <= Compare_To_Zero_out1;

END rtl;

