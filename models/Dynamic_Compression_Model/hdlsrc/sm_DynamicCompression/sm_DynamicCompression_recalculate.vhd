-- -------------------------------------------------------------
-- 
-- File Name: /home/cb54103/Documents/fpga-open-speech-tools/simulink_models/models/Dynamic_Compression_Model/hdlsrc/sm_DynamicCompression/sm_DynamicCompression_recalculate.vhd
-- 
-- Generated by MATLAB 9.7 and HDL Coder 3.15
-- 
-- -------------------------------------------------------------


-- -------------------------------------------------------------
-- 
-- Module: sm_DynamicCompression_recalculate
-- Source Path: sm_DynamicCompression/dataplane/Avalon Data Processing/Left Channel Processing/recalculate
-- Hierarchy Level: 3
-- 
-- -------------------------------------------------------------
LIBRARY IEEE;
USE IEEE.std_logic_1164.ALL;
USE IEEE.numeric_std.ALL;

ENTITY sm_DynamicCompression_recalculate IS
  PORT( clk                               :   IN    std_logic;
        reset                             :   IN    std_logic;
        enb_1_1024_0                      :   IN    std_logic;
        enb                               :   IN    std_logic;
        enb_1_1024_5                      :   IN    std_logic;
        Register_Data                     :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
        Register_Addr                     :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
        sig                               :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
        Valid_in                          :   IN    std_logic;
        proc_sig                          :   OUT   std_logic_vector(31 DOWNTO 0)  -- sfix32_En28
        );
END sm_DynamicCompression_recalculate;


ARCHITECTURE rtl OF sm_DynamicCompression_recalculate IS

  -- Component Declarations
  COMPONENT sm_DynamicCompression_Nchan_FbankAGC_AID
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_1024_0                    :   IN    std_logic;
          enb                             :   IN    std_logic;
          enb_1_1024_5                    :   IN    std_logic;
          Register_Data                   :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
          Register_Addr                   :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
          input_signal                    :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
          Valid_in                        :   IN    std_logic;
          proc_sig                        :   OUT   std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
          Valid_out                       :   OUT   std_logic
          );
  END COMPONENT;

  COMPONENT sm_DynamicCompression_Static_pFIR_block
    PORT( clk                             :   IN    std_logic;
          reset                           :   IN    std_logic;
          enb_1_1024_0                    :   IN    std_logic;
          enb                             :   IN    std_logic;
          Compressed_Data_In              :   IN    std_logic_vector(31 DOWNTO 0);  -- sfix32_En28
          Valid_in                        :   IN    std_logic;
          Data_out                        :   OUT   std_logic_vector(31 DOWNTO 0)  -- sfix32_En28
          );
  END COMPONENT;

  -- Component Configuration Statements
  FOR ALL : sm_DynamicCompression_Nchan_FbankAGC_AID
    USE ENTITY work.sm_DynamicCompression_Nchan_FbankAGC_AID(rtl);

  FOR ALL : sm_DynamicCompression_Static_pFIR_block
    USE ENTITY work.sm_DynamicCompression_Static_pFIR_block(rtl);

  -- Signals
  SIGNAL Nchan_FbankAGC_AID_out1          : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL Nchan_FbankAGC_AID_out2          : std_logic;
  SIGNAL re_level_eq_sig                  : std_logic_vector(31 DOWNTO 0);  -- ufix32
  SIGNAL re_level_eq_sig_signed           : signed(31 DOWNTO 0);  -- sfix32_En28
  SIGNAL Compare_To_Constant_out1         : std_logic;
  SIGNAL Constant_out1                    : signed(31 DOWNTO 0);  -- sfix32_En28
  SIGNAL Switch_out1                      : signed(31 DOWNTO 0);  -- sfix32_En28
  SIGNAL Compare_To_Constant1_out1        : std_logic;
  SIGNAL Constant1_out1                   : signed(31 DOWNTO 0);  -- sfix32_En28
  SIGNAL Switch1_out1                     : signed(31 DOWNTO 0);  -- sfix32_En28

BEGIN
  -- High Clipping
  -- 
  -- Prescription Application
  -- 
  -- Low Clipping

  u_Nchan_FbankAGC_AID : sm_DynamicCompression_Nchan_FbankAGC_AID
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_1024_0 => enb_1_1024_0,
              enb => enb,
              enb_1_1024_5 => enb_1_1024_5,
              Register_Data => Register_Data,  -- sfix32_En28
              Register_Addr => Register_Addr,  -- sfix32_En28
              input_signal => sig,  -- sfix32_En28
              Valid_in => Valid_in,
              proc_sig => Nchan_FbankAGC_AID_out1,  -- sfix32_En28
              Valid_out => Nchan_FbankAGC_AID_out2
              );

  u_Static_pFIR : sm_DynamicCompression_Static_pFIR_block
    PORT MAP( clk => clk,
              reset => reset,
              enb_1_1024_0 => enb_1_1024_0,
              enb => enb,
              Compressed_Data_In => Nchan_FbankAGC_AID_out1,  -- sfix32_En28
              Valid_in => Nchan_FbankAGC_AID_out2,
              Data_out => re_level_eq_sig  -- sfix32_En28
              );

  re_level_eq_sig_signed <= signed(re_level_eq_sig);

  
  Compare_To_Constant_out1 <= '1' WHEN re_level_eq_sig_signed >= to_signed(268435456, 32) ELSE
      '0';

  Constant_out1 <= to_signed(268435456, 32);

  
  Switch_out1 <= re_level_eq_sig_signed WHEN Compare_To_Constant_out1 = '0' ELSE
      Constant_out1;

  
  Compare_To_Constant1_out1 <= '1' WHEN Switch_out1 <= to_signed(-268435456, 32) ELSE
      '0';

  Constant1_out1 <= to_signed(-268435456, 32);

  
  Switch1_out1 <= Switch_out1 WHEN Compare_To_Constant1_out1 = '0' ELSE
      Constant1_out1;

  proc_sig <= std_logic_vector(Switch1_out1);

END rtl;

